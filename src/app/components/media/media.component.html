<div *ngIf="med != null" class="container">
  <div class="row">
    <div class="col-md-12">
      <img style="max-width:100%;max-height: 100%;" src="{{med.url}}">
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h2 class="no-margin-bottom">
        <div *ngIf="!addTitleShown">
          {{med.title != null ? med.title : "&lt;unknown title&gt;"}}
          <button class="edit-button" aria-label="edit" (click)="addTitleShown=true">
            <mat-icon>edit</mat-icon>
          </button>
        </div>
        <form (ngSubmit)="submitTitleForm()" *ngIf="addTitleShown">
          <mat-form-field class="full-width-input">
            <input matInput placeholder="Title" [formControl]="titleInput">
          </mat-form-field>
          <button mat-flat-button color="primary" type="submit">{{med.title != null ? "Edit Title" : "Add Title"}}</button>
          <button mat-flat-button type="button" (click)="addTitleShown=false">Cancel</button>
        </form>
      </h2>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <p>
        <ng-container *ngIf="setDateShown === true; then setDate; else (med.timestamp != null && knownDate) || (unknownDate)">
        </ng-container>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <p *ngIf="med.description != null && !addDescriptionShown">{{med.description}}</p>
      <p (click)="addDescriptionShown=true" *ngIf="!addDescriptionShown" class="edit-description">
        {{med.description == null ? "Add description" : "Edit Description"}}</p>
      <form (ngSubmit)="submitDescriptionForm()" *ngIf="addDescriptionShown">
        <mat-form-field class="full-width-input">
          <textarea matInput placeholder="Description" [formControl]="descriptionInput"></textarea>
        </mat-form-field>
        <button mat-flat-button color="primary" type="submit">Send Comment</button>
        <button mat-flat-button type="button" (click)="addDescriptionShown=false">Cancel</button>
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-12 first-sm">
      <div class="box box-container">
        <div class="row">
          <div class="col-md-12">
            <h3>Kommentare</h3>
          </div>
        </div>
        <ng-container *ngIf="med.comments == null else comments">

        </ng-container>
        <div class="row">
          <div class="col-md-12">
            <button mat-flat-button color="primary" (click)="addCommentShown=true" *ngIf="!addCommentShown">
              Comment
            </button>
            <form (ngSubmit)="submitCommentForm()" *ngIf="addCommentShown">
              <mat-form-field class="full-width-input">
                <textarea matInput placeholder="Kommentar" [formControl]="commentInput"></textarea>
              </mat-form-field>
              <button mat-flat-button color="primary" type="submit">Send Comment</button>
              <button mat-flat-button type="button" (click)="addCommentShown=false">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-sm-12 first-xs">
      <div class="box box-container">
        <div class="row">
          <div class="col-md-12">
            <h3>
              Tags
              <button class="tag-button" (click)="addTagShown=true" *ngIf="!addTagShown">
                <mat-icon>add</mat-icon>
              </button>
            </h3>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <ng-container *ngIf="med.tags == null else tags">
            </ng-container>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <form (ngSubmit)="submitTagForm()" *ngIf="addTagShown">
              <mat-form-field class="full-width-input">
                <input matInput placeholder="Tags (kommasepariert)" type="text" [formControl]="tagInput"
                  [matAutocomplete]="auto">
                <mat-autocomplete autoActivateFirstOption #auto="matAutocomplete">
                  <mat-option *ngFor="let tag of tagAutoComplete$ | async; let index = index" [value]="tag.name">
                    {{ tag.name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <button mat-flat-button color="primary" type="submit">Save Tags</button>
              <button mat-flat-button type="button" (click)="addTagShown=false">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #knownDate>
  Taken on <span (click)="setDateShown=true">{{med.timestamp * 1000 | date: 'dd. MMMM yyyy'}}</span> and uploaded on
  {{med.timestampUpload * 1000 | date: 'dd. MMMM yyyy'}}
</ng-template>

<ng-template #unknownDate>
  Taken on <i (click)="setDateShown=true">&lt;unknown&gt;</i> and uploaded on {{med.timestampUpload * 1000 | date: 'dd. MMMM yyyy'}}
</ng-template>

<ng-template #setDate>
  Taken on
  <mat-form-field>
    <input matInput placeholder="date" [formControl]="med.timestamp * 1000" formControlName="timestamp" [matDatepicker]="timestamp" (dateChange)="submitDateForm($event)">
    <mat-datepicker-toggle matSuffix [for]="timestamp"></mat-datepicker-toggle>
    <mat-datepicker #timestamp></mat-datepicker>
  </mat-form-field>
  and uploaded on {{med.timestampUpload * 1000 | date: 'dd. MMMM yyyy'}}
</ng-template>

<ng-template #tags>
  <div class="tags">
    <span class="tag" *ngFor="let tag of med.tags">
      <a class="tag-link" routerLink="/home/{{tag}}">{{tag}}</a>
    </span>
  </div>
</ng-template>

<ng-template #comments>
  <div class="row">
    <div class="col-md-12">
      <div class="comment" *ngFor="let comment of med.comments">
        <div class="comment-profile">
          <div class="comment-profile-img">
            <img src="{{ getProfileImage(comment.username) }}">
          </div>
        </div>
        <div class="comment-content">{{ comment.comment }}</div>
        <div class="comment-footer">{{ comment.timestamp * 1000 | date: 'dd.MM.yyyy hh:mm' }} - {{ comment.username }}
        </div>
      </div>
    </div>
  </div>
</ng-template>
